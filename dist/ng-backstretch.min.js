/*!
 * ng-backstretch
 * https://github.com/rprovost/ng-backstretch
 *
 * Copyright (c) 2014-2015 Ryan Provost
 * Licensed under the MIT license.
 */
angular.module("ng-backstretch",[]).directive("backstretch",["$window","$timeout",function(e,t){return{restrict:"A",scope:{images:"&backstretchImages",duration:"&backstretchDuration",fade:"&backstretchFade"},link:function(a,i){a.duration=a.duration()||5e3,a.fade=a.fade()||0;var r={wrapper:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999998,position:"absolute"},image:{position:"absolute",opacity:0,margin:0,padding:0,backgroundSize:"cover",border:"none",width:"100%",height:"100%",maxHeight:"none",maxWidth:"none",zIndex:-999999,transition:"all "+a.fade+"s"}};a.wrapper=angular.element('<div class="backstretch"></div>'),a.wrapper.css(r.wrapper),i.append(a.wrapper),a.index=0,a.started=!1,a.load=function(){var e;return 0===a._images.length?!1:(a._images.forEach(function(t){a.image=angular.element("<div>"),a.image.css(r.image),a.image.css("background-image","url("+(e=t)+")"),a.wrapper.append(a.image)}),a.ratio=this.width/this.height,a.resize(),angular.element("<img>").attr("src",e).on("load",function(){a.show(a.index++)}),void(a.started||(a.started=!0)))},a.resize=function(){var e,t={left:0,top:0,width:"auto",height:"auto"},r=i[0].offsetWidth,n=r,o=i[0].offsetHeight>0?i[0].offsetHeight:i[0].offsetParent.offsetHeight,s=n/a.ratio;o>s?(s=o,n=s*a.ratio,e=(n-r)/2,t.left="-"+e+"px"):(e=(s-o)/2,t.top="-"+e+"px"),t.width=n+"px",t.height=s+"px",a.wrapper.css({width:r,height:o});for(var d=0;d<a.wrapper.children().length;d++){var g=angular.element(a.wrapper.children()[d]);g.css(t)}},a.show=function(e){var i=a.wrapper.children()[e];return a.image=angular.element(i),1===a._images.length?void a.image.css({opacity:1}):(e<a._images.length-1||(a.index=0),a.image.css({opacity:1}),t(function(){a.image.css({opacity:0})},a.duration),void t(function(){a.show(a.index++)},a.duration))},a.$watch(function(){return a.images()},function(e){e&&e[0]&&(a._images=Array.isArray(a.images())?a.images():[a.images()],a.started||a.load())}),angular.element(e).bind("resize",a.resize),a.$on("$destroy",function(){angular.element(e).unbind("resize",a.resize)})}}}]);
