/*!
 * ng-backstretch
 * https://github.com/rprovost/ng-backstretch
 *
 * Copyright (c) 2014-2015 Ryan Provost
 * Licensed under the MIT license.
 */
angular.module("ng-backstretch",[]).directive("backstretch",["$window","$timeout",function(e,a){return{restrict:"A",scope:{images:"&backstretchImages",duration:"&backstretchDuration",fade:"&backstretchFade"},link:function(t,i){t.duration=t.duration()||5e3,t.fade=t.fade()||0;var r={wrapper:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999998,position:"absolute"},image:{position:"absolute",opacity:0,margin:0,padding:0,backgroundSize:"cover",border:"none",width:"100%",height:"100%",maxHeight:"none",maxWidth:"none",zIndex:-999999,transition:"all "+t.fade+"s"}};t.wrapper=angular.element('<div class="backstretch"></div>'),t.wrapper.css(r.wrapper),i.append(t.wrapper),t.index=0,t.started=!1,t.load=function(){var e;return 0===t._images.length?!1:(t._images.forEach(function(a){a&&(t.image=angular.element('<div class="img">'),t.image.css(r.image),t.image.css("background-image","url("+(e=a)+")"),t.wrapper.append(t.image))}),t.ratio=this.width/this.height,t.resize(),angular.element("<img>").attr("src",e).on("load",function(){t.show(t.index++)}),void(t.started||(t.started=!0)))},t.resize=function(){var e,a={left:0,top:0,width:"auto",height:"auto"},r=i[0].offsetWidth,n=r,o=i[0].offsetHeight>0?i[0].offsetHeight:i[0].offsetParent.offsetHeight,s=n/t.ratio;o>s?(s=o,n=s*t.ratio,e=(n-r)/2,a.left="-"+e+"px"):(e=(s-o)/2,a.top="-"+e+"px"),a.width=n+"px",a.height=s+"px",t.wrapper.css({width:r,height:o});for(var d=0;d<t.wrapper.children().length;d++){var g=angular.element(t.wrapper.children()[d]);g.css(a)}},t.show=function(e){var i=t.wrapper.children()[e];return t.image=angular.element(i),1===t._images.length?void t.image.css({opacity:1}):(e<t._images.length-1||(t.index=0),t.image.removeClass("animated"),void i.offsetWidth,t.image.addClass("animated"),t.image.css({opacity:1}),a(function(){t.image.css({opacity:0})},t.duration),void a(function(){t.show(t.index++)},t.duration))},t.$watch(function(){return t.images()},function(e){e&&e[0]&&(t._images=Array.isArray(e)?e:[e],t.started||t.load())}),angular.element(e).bind("resize",t.resize),t.$on("$destroy",function(){angular.element(e).unbind("resize",t.resize)})}}}]);
